
# 개요
https://blog.christianposta.com/understanding-mcp-authorization-step-by-step/

이 글은 위 블로그 내용을 재구성한 것 입니다. 

MCP (Model Context Protocol) 서버에 HTTP Transport와 Authorization을 구현하는 방법을 설명하고 있습니다. 실제로 MCP 서버를 구축하고 AI 에이전트 및 LLM 애플리케이션에 연결하는 것은 비교적 간단합니다. 하지만 단순히 stido-transport MCP 서버이므로 기업에서 실제로 운영하기위해는 보안을 강화할 필요가 있습니다. 

MCP 커뮤니티는 지속적으로 인가(Authorization)에 대한 스펙을 지속적으로 개선해왔습니다. 

이번 글에서는 최신 MCP 인가(Authorization) 스펙을 단계별로 살펴보고 실제로 어떻게 구현하는지 알아 보겠습니다. 


# MCP 인증의 필수조건

## MCP Authorization 스펙을 사용하려면 HTTP Transport가 필수입니다. 

OAuth 2.1은 HTTP 기반 프로토콜이기 때문입니다. 

OAuth 2.1 생태계:
├── RFC 6749: OAuth 2.0 (HTTP 기반)
├── RFC 8414: Authorization Server Metadata (`/.well-known/`)
├── RFC 9728: Protected Resource Metadata (`/.well-known/`)
├── RFC 7517: JSON Web Key (JWKS) (`HTTP 엔드포인트`)
└── RFC 8707: Resource Indicators (`HTTP 헤더`)

즉 HTTP를 사용하지 않는다면 RFC 표준을 준수할 수가 없습니다 .


## HTTP 전송을 사용하여 MCP 서버 구축

MCP 클라이언트가 MCP 엔드포인트로 `JSON-RPC` 메세지 전송을 할때는 반드시 HTTP POST 방식을 사용해야합니다. 




샘플 예 

```bash
curl -v -s -X POST http://localhost:9000/mcp \
  -H "Content-Type: application/json" \
  -H "Origin: http://localhost:3000" \
  -d '{"jsonrpc": "2.0", "id": 1, "method": "initialize"}'
```


## MCP 서버에 도구를 추가합니다


## TOOL, LIST, 


# MCP 권한 부여 이해하기 2부


최근 개정된 MCP Authorization 스펙은 OAuth 2.1을 적극 활용한다. MCP 서버를 OAuth의 리소스 서버로 취급한다. 따라서 Auth0, Okta, Keycloak같은 기존 IdP를 사용하여 MCP서버를 보호 할 수 있다.

- Authorization 서버는 OAuth 2.1을 구현해야 함
- MCP 서버는 OAuth 2.0 Protected Resource Metadata (RFC9728) 구현 필수
- MCP 클라이언트는 이 메타데이터를 사용하여 authorization 서버를 발견해야 함
- Authorization 서버는 OAuth 2.0 Authorization Server Metadata (RFC8414) 제공 필수

## 5단계: MCP 승인 구현 준비

이제 여기서 MCP 서버의 로컬 공개키(Public Key)를 설정하고 JWKS(JSON Web Key Set)로 노출한다.

- `mcp_public_key.pem` 를 생성
- `/.well-known/jwks.json` 를 공개하여 고객에게 공개키를 제공


```bash
curl -s localhost:9000/.well-known/jwks.json | jq .
```


## 6단계 :  토큰 검증 구현 및 메타데이터 노출

RFC 9728 사양에서는 401응답은 다음과 같은 내용을 반환해야한다.( 클라이언트가 인증이나 권한 부여를 받지 못한 경우, 인증 및 권한 부여 방법을 찾아야 하기 때문에 중요)

401에러시 
- `/.well-known/oauth-protected-resource` 엔드포인트 노출

## 7단계 : 보호된 리소스 메타 데이터 구현



```bash
curl -s localhost:9000/.well-known/oauth-protected-resource | jq .
```



`authorization_servers`목록입니다. 이 목록은 클라이언트가 인증을 받고 토큰을 얻기 위해 확인해야 할 위치를 알려줍니다. 이 경우 로컬 키를 사용하고 있으므로 실제 서버를 가리키는 것이 아니라, 예시로 제시된 MCP 서버를 가리킵니다.


>MCP 클라이언트는 인증 서버와 상호 작용하는 데 필요한 정보를 얻기 위해 OAuth 2.0 인증 서버 메타데이터 RFC8414 사양을 반드시 준수해야 합니다.


```bash
curl -s localhost:9000/.well-known/oauth-authorization-server | jq .
```


