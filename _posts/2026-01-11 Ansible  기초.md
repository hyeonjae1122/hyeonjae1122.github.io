```sh
$PASSWORD=
$USERNMAE=
$IP=

sshpass -p $PASSWORD ssh-copy-id -i ~/.ssh/id_rsa.pub -o StrictHostKeyChecking=no $USERNAME$@$IP
```

# 생성된 user를 ansible.builtin.user 모듈을 통해서 제거하기 


- playbook(`example.yaml`)에 그룹(`test-admin`)을 생성하고 유저(`testuser`) 를 추가

```yaml
---

- hosts: desktop-linux
  tasks:
  - name: 리눅스 내에서 그룹 'test-admin'을 생성
    ansible.builtin.group:
      name: test-admin
      state: present
  
  - name: 리눅스 내에서 사용자 'testuser' 생성 후 특정 uid와 주 그룹을 'test-admin'으로 설정
    ansible.builtin.user:
      name: testuser
      comment: Test User
      uid: 1040
      group: test-admin 
```


```bash
# 플레이북 실행
ansible-playbook ./example.yaml

# 다른 터미널에서 모니터링
watch -d "ssh desktop-linux tail -n 3 /etc/passwd"
```



![](https://raw.githubusercontent.com/hyeonjae1122/hyeonjae1122.github.io/main/assets/20260111T150325895Z.png)


- 추가한 유저(`testuser`) 삭제하기

```yaml
---

- hosts: desktop-linux
  tasks:  
  - name:  리눅스 내에서 사용자 'testuser'를 삭제
    ansible.builtin.user:
      name: testuser
      state: absent
      remove: yes
```

- 유저가 삭제 되었는지 확인

![](https://raw.githubusercontent.com/hyeonjae1122/hyeonjae1122.github.io/main/assets/20260111T150639404Z.png)


# 반복문으로  대량의 유저 생성하고 삭제해보기 

- `testuser1~10`의 유저를 추가 하기

```yaml
---

- hosts: desktop-linux
  tasks:  
  - name: 리눅스 내에서 사용자 'testuser1~10' 생성    
    ansible.builtin.user:
      name: testuser{{ item }}
    loop: "{{ range(1, 11) | list }}"
  
  - name: 생성된 사용자 확인
    ansible.builtin.shell: "getent passwd | grep testuser"
    register: users

  - name: 사용자 정보 출력
    ansible.builtin.debug:
      msg: "{{ users.stdout_lines }}"

  - name: 생성된 사용자 삭제
    ansible.builtin.user:
      name: testuser{{ item }}
      state: absent
    loop: "{{ range(1, 11) | list }}"
```

![](https://raw.githubusercontent.com/hyeonjae1122/hyeonjae1122.github.io/main/assets/20260111T152751241Z.png)


- 결과

```bash
PLAY [desktop-linux] ******************************************************************************************************************************************************************************

TASK [Gathering Facts] ****************************************************************************************************************************************************************************
ok: [desktop-linux]

TASK [리눅스 내에서 사용자 'testuser1~10' 생성] ***************************************************************************************************************************************************
changed: [desktop-linux] => (item=1)
changed: [desktop-linux] => (item=2)
changed: [desktop-linux] => (item=3)
changed: [desktop-linux] => (item=4)
changed: [desktop-linux] => (item=5)
changed: [desktop-linux] => (item=6)
changed: [desktop-linux] => (item=7)
changed: [desktop-linux] => (item=8)
changed: [desktop-linux] => (item=9)
changed: [desktop-linux] => (item=10)

TASK [생성된 사용자 확인] *************************************************************************************************************************************************************************
changed: [desktop-linux]

TASK [사용자 정보 출력] ***************************************************************************************************************************************************************************
ok: [desktop-linux] => {
    "msg": [
        "testuser1:x:1002:1003::/home/testuser1:/bin/sh",
        "testuser2:x:1003:1004::/home/testuser2:/bin/sh",
        "testuser3:x:1004:1005::/home/testuser3:/bin/sh",
        "testuser4:x:1005:1006::/home/testuser4:/bin/sh",
        "testuser5:x:1006:1007::/home/testuser5:/bin/sh",
        "testuser6:x:1007:1008::/home/testuser6:/bin/sh",
        "testuser7:x:1008:1009::/home/testuser7:/bin/sh",
        "testuser8:x:1009:1010::/home/testuser8:/bin/sh",
        "testuser9:x:1010:1011::/home/testuser9:/bin/sh",
        "testuser10:x:1011:1012::/home/testuser10:/bin/sh"
    ]
}

TASK [생성된 사용자 삭제] *************************************************************************************************************************************************************************
changed: [desktop-linux] => (item=1)
changed: [desktop-linux] => (item=2)
changed: [desktop-linux] => (item=3)
changed: [desktop-linux] => (item=4)
changed: [desktop-linux] => (item=5)
changed: [desktop-linux] => (item=6)
changed: [desktop-linux] => (item=7)
changed: [desktop-linux] => (item=8)
changed: [desktop-linux] => (item=9)
changed: [desktop-linux] => (item=10)

PLAY RECAP ****************************************************************************************************************************************************************************************
desktop-linux              : ok=5    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

```


# 관리 대상  uptime 을 ansible.builtin.debug 모듈을 통해 가져오기


```yaml
---

- hosts: desktop-linux
  tasks:  
  - name:  uptime 정보 가져오기
    ansible.builtin.shell: /usr/bin/uptime
    register: result 

  - name: 이전 태스크로부터 리턴된 결과를 출력
    ansible.builtin.debug:
      var: result.stdout_lines
```


![](https://raw.githubusercontent.com/hyeonjae1122/hyeonjae1122.github.io/main/assets/20260111T151756621Z.png)