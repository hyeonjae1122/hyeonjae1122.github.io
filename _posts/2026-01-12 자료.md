
kubeadm join 192.168.0.245:6443 --token myj37e.duj6u48dakzrb5en \
	--discovery-token-ca-cert-hash sha256:c651319d7b191c5b260c56c3344304848409520a09569ec3497613132209e0d3


eyJhIjoiOWYzYjRlZDY2NzRlNTQyMmNmZjU5NzVjN2E0YTg2MjYiLCJ0IjoiYzBjMWZiOTctMzNkMi00Y2E4LTliMjAtZGIyY2QxMzgxNjQyIiwicyI6Ik9UbGtPRFV4WXpndE56TXdNQzAwWmpFeUxUZ3pZamN0TTJObU5HUTNNemxoTXpkbCJ9


오늘 트러블 슈팅한것

- 라즈베리파이가 자꾸 swap이 걸린다
```
systemctl list-unit-files | grep -i zram
rpi-zram-writeback.service                   static          -
systemd-zram-setup@.service                  static          -
dev-zram0.swap                               generated       -
rpi-zram-writeback.timer                     generated       
```
자꾸 dev-zram0.swap이 스왑을 걸고 있었다. 

```
# 1. 현재 실행 중인 zram swap 중지
sudo swapoff /dev/zram0

# 2. dev-zram0.swap 서비스 중지 및 마스크
sudo systemctl stop dev-zram0.swap
sudo systemctl mask dev-zram0.swap

# 3. rpi-zram-writeback 타이머 비활성화
sudo systemctl stop rpi-zram-writeback.timer
sudo systemctl mask rpi-zram-writeback.timer

# 4. systemd-zram-generator 설정 찾기
ls -la /etc/systemd/zram-generator.conf
ls -la /usr/lib/systemd/zram-generator.conf.d/

# 5. systemd-zram-generator 설정 비활성화
if [ -f /etc/systemd/zram-generator.conf ]; then
    sudo mv /etc/systemd/zram-generator.conf /etc/systemd/zram-generator.conf.disabled
fi

# 6. 라즈베리파이 zram 설정 비활성화
if [ -f /usr/lib/systemd/zram-generator.conf.d/zram-generator.conf ]; then
    sudo mv /usr/lib/systemd/zram-generator.conf.d/zram-generator.conf \
           /usr/lib/systemd/zram-generator.conf.d/zram-generator.conf.disabled
fi

# 또는 설정 파일을 빈 내용으로 덮어쓰기
sudo mkdir -p /etc/systemd/zram-generator.conf.d
echo "" | sudo tee /etc/systemd/zram-generator.conf.d/disable-zram.conf

# 7. zram 모듈 블랙리스트
echo "blacklist zram" | sudo tee /etc/modprobe.d/blacklist-zram.conf

# 8. systemd daemon 리로드
sudo systemctl daemon-reload

# 9. 확인
free -h
sudo swapon --show
```



- 컨트롤 플레인에서 flannel의 cni 바이너리 파일에 bridge가 없었다.
    - ls -l /opt/cni/bin/ 
- 컨트롤 플레인에서 --ifcae=enp0s9로 설정해버렷다. (실습내용 복붙)
    - 그러다보니 실제 내 서버의 인터페이스랑은 다르니 에러가 발생
```
kubectl create namespace kube-flannel
cat << EOF > flannel.yaml
podCidr: "10.244.0.0/16"
flannel:
  cniBinDir: "/opt/cni/bin"
  cniConfDir: "/etc/cni/net.d"
  args:
  - "--ip-masq"
  - "--kube-subnet-mgr"
  - "--iface=enp0s9"  
  backend: "vxlan"
EOF

```

- 워커노드에서 /run/systemd/resolve/resolv.conf 파일이 존재하지 않았다. 


```
# 1. 디렉토리 생성
sudo mkdir -p /run/systemd/resolve

# 2. 심볼릭 링크 생성
sudo ln -sf /etc/resolv.conf /run/systemd/resolve/resolv.conf

# 3. 확인
ls -l /run/systemd/resolve/resolv.conf
cat /run/systemd/resolve/resolv.conf

# 4. kubelet 재시작
sudo systemctl restart kubelet

# 5. kubelet 상태 확인
sudo systemctl status kubelet
```


